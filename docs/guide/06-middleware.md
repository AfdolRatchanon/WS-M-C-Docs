# Step 6 ‚Äî Middleware ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô

> üéØ **Analogy:** Middleware ‡∏Ñ‡∏∑‡∏≠ "‡∏î‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à" ‡∏ó‡∏µ‡πà request ‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‚Äî ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á ‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á

## Middleware ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

‡πÉ‡∏ô Express **Middleware** ‡∏Ñ‡∏∑‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Request ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÅ‡∏•‡∏∞ Response ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ ‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:

```js
(req, res, next) => {
  // ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á...
  next()  // ‡∏™‡πà‡∏á request ‡πÑ‡∏õ‡πÉ‡∏´‡πâ middleware/route ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
}
```

‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á Request:

```
Client Request
      ‚îÇ
      ‚ñº
[cors()]                 ‚Üê ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï cross-origin
      ‚îÇ
      ‚ñº
[express.json()]         ‚Üê ‡πÅ‡∏õ‡∏•‡∏á JSON body ‡πÄ‡∏õ‡πá‡∏ô req.body
      ‚îÇ
      ‚ñº
[express.urlencoded()]   ‚Üê ‡πÅ‡∏õ‡∏•‡∏á form body ‡πÄ‡∏õ‡πá‡∏ô req.body
      ‚îÇ
      ‚ñº
[Route Handler]          ‚Üê ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ (albums.js, songs.js ‡∏Ø‡∏•‡∏Ø)
      ‚îÇ
      ‚ñº
Response ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö Client
```

## ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Client

‡πÄ‡∏°‡∏∑‡πà‡∏≠ client ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏ó‡∏µ‡πà server ‡∏°‡∏µ 3 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å:

| Content-Type | ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á | Parser |
|:-------------|:------------|:--------|:-------|
| `application/json` | JSON string | `{"name":"John"}` | `express.json()` |
| `application/x-www-form-urlencoded` | key=value pairs | `name=John&age=20` | `express.urlencoded()` |
| `multipart/form-data` | ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô parts (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå) | form + ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ | `multer` (Step 11) |

## CORS ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**CORS (Cross-Origin Resource Sharing)** ‚Äî ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Frontend (‡πÄ‡∏ä‡πà‡∏ô React ‡∏ó‡∏µ‡πà port 5173) ‡∏™‡πà‡∏á request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Backend (port 3000) Browser ‡∏à‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Å request ‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ origin ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô

`cors()` middleware ‡∏ö‡∏≠‡∏Å Browser ‡∏ß‡πà‡∏≤ "‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏î‡πâ" ‡∏ú‡πà‡∏≤‡∏ô HTTP Headers ‡∏û‡∏¥‡πÄ‡∏®‡∏©

## ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á cors

```bash
npm install cors
```

## ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `app.js`

‡πÅ‡∏Å‡πâ `app.js` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå:

```js
require('dotenv').config()
const express = require('express')
const cors = require('cors')
const path = require('path')

const app = express()
const PORT = process.env.PORT || 3000

// ‚îÄ‚îÄ‚îÄ Middleware ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
app.use(cors())                                      // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï cross-origin request
app.use(express.json())                              // parse JSON body ‚Üí req.body
app.use(express.urlencoded({ extended: true }))      // parse URL-encoded body ‚Üí req.body
app.use('/uploads', express.static(                  // serve ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå uploads
  path.join(__dirname, 'uploads')
))

// ‚îÄ‚îÄ‚îÄ Routes (‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Step ‡∏ñ‡∏±‡∏î‡πÜ ‡πÑ‡∏õ) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
app.get('/', (_req, res) => {
  res.json({ message: 'Module C - Music Album API' })
})

// ‚îÄ‚îÄ‚îÄ Start Server ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
app.listen(PORT, () => {
  console.log(`Server running on http://localhost:${PORT}`)
})
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ó‡∏µ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**

`app.use(cors())` ‚Äî ‡πÉ‡∏ä‡πâ middleware cors ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å route

`app.use(express.json())` ‚Äî ‡∏ó‡∏≥‡πÉ‡∏´‡πâ `req.body` ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠ client ‡∏™‡πà‡∏á JSON ‡∏°‡∏≤

`app.use(express.urlencoded({ extended: true }))` ‚Äî ‡∏ó‡∏≥‡πÉ‡∏´‡πâ `req.body` ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠ client ‡∏™‡πà‡∏á URL-encoded form ‡∏°‡∏≤

`app.use('/uploads', express.static(...))` ‚Äî ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `uploads/` ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô URL `/uploads/filename.jpg`

## ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‚Äî ‡∏™‡πà‡∏á JSON Body

‡πÄ‡∏û‡∏¥‡πà‡∏° route ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÉ‡∏ô `app.js`:

```js
app.post('/test-body', (req, res) => {
  console.log('req.body:', req.body)
  res.json({ received: req.body })
})
```

‡πÉ‡∏ô **Postman:**
1. Method: `POST`
2. URL: `http://localhost:3000/test-body`
3. ‡πÅ‡∏ó‡πá‡∏ö **Body** ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **raw** ‚Üí dropdown ‡πÄ‡∏õ‡πá‡∏ô **JSON**
4. ‡πÉ‡∏™‡πà:
```json
{ "name": "test", "age": 20 }
```
5. ‡∏Å‡∏î **Send**

::: details ‚úÖ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
```json
{ "received": { "name": "test", "age": 20 } }
```
‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ô‡∏µ‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤ `express.json()` ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Äî ‡∏•‡∏ö route ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
:::

## Glossary

| ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ |
|:--------|:---------|
| **Middleware** | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á request ‡∏Å‡∏±‡∏ö response |
| **next()** | ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á middleware/route ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ |
| **CORS** | ‡∏Å‡∏•‡πÑ‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ browser ‡∏™‡πà‡∏á request ‡∏Ç‡πâ‡∏≤‡∏° origin ‡πÑ‡∏î‡πâ |
| **req.body** | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà client ‡∏™‡πà‡∏á‡∏°‡∏≤‡πÉ‡∏ô request body (‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô parser ‡∏Å‡πà‡∏≠‡∏ô) |
| **static files** | ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà serve ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô route handler |
| **path.join()** | ‡∏™‡∏£‡πâ‡∏≤‡∏á file path ‡πÅ‡∏ö‡∏ö cross-platform (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á Windows/Mac/Linux) |
| **__dirname** | ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Node.js ‡∏ö‡∏≠‡∏Å path ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà |

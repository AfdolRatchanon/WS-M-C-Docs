# à¸ à¸²à¸à¸£à¸§à¸¡ Module C â€” RESTful API

## à¹‚à¸ˆà¸—à¸¢à¹Œà¸‚à¸­à¸‡ Module C à¸„à¸·à¸­à¸­à¸°à¹„à¸£?

Module C à¸¡à¸­à¸šà¸«à¸¡à¸²à¸¢à¹ƒà¸«à¹‰à¸ªà¸£à¹‰à¸²à¸‡ **Music Album RESTful API** à¸”à¹‰à¸§à¸¢ Node.js à¹‚à¸”à¸¢à¸¡à¸µà¸‚à¹‰à¸­à¸à¸³à¸«à¸™à¸”à¸”à¸±à¸‡à¸™à¸µà¹‰:

> à¸ªà¸£à¹‰à¸²à¸‡ HTTP Server à¸—à¸µà¹ˆà¸£à¸±à¸š Request à¸ˆà¸²à¸ Client (à¹€à¸Šà¹ˆà¸™ Postman à¸«à¸£à¸·à¸­ Frontend) à¹à¸¥à¸°à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸”à¹‰à¸§à¸¢ JSON à¸œà¹ˆà¸²à¸™ **RESTful API** à¹‚à¸”à¸¢à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸šà¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ MySQL à¹€à¸à¸·à¹ˆà¸­à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Album à¹à¸¥à¸° Song

### à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸ªà¸£à¹‰à¸²à¸‡

| à¸à¸¥à¸¸à¹ˆà¸¡ Route | Endpoint | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|:------------|:---------|:---------|
| **Auth** | `POST /api/login` | à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š â€” à¸£à¸±à¸š token à¸à¸¥à¸±à¸šà¸¡à¸² |
| | `POST /api/register` | à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸à¹ƒà¸«à¸¡à¹ˆ |
| | `POST /api/logout` | à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š â€” à¸¥à¸š token |
| **Albums** | `GET /api/albums` | à¸”à¸¹à¸£à¸²à¸¢à¸à¸²à¸£à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (Cursor Pagination) |
| | `GET /api/albums/:id` | à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡ + à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡ |
| | `GET /api/albums/:id/songs` | à¸”à¸¹à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡à¹ƒà¸™à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡ |
| | `POST /api/albums` | à¸ªà¸£à¹‰à¸²à¸‡à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡à¹ƒà¸«à¸¡à¹ˆ (publisher/admin à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™) |
| | `PUT /api/albums/:id` | à¹à¸à¹‰à¹„à¸‚à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡ (à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡/admin) |
| | `DELETE /api/albums/:id` | à¸¥à¸šà¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡ (à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡/admin) |
| **Songs** | `GET /api/songs` | à¸”à¸¹à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¸à¸£à¹‰à¸­à¸¡ search) |
| | `GET /api/songs/:id` | à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸à¸¥à¸‡ + à¸šà¸±à¸™à¸—à¸¶à¸ view |
| | `POST /api/albums/:id/songs` | à¹€à¸à¸´à¹ˆà¸¡à¹€à¸à¸¥à¸‡à¹ƒà¸™à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡ (à¸à¸£à¹‰à¸­à¸¡ upload à¸£à¸¹à¸›) |
| | `POST /api/albums/:id/songs/:songId` | à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸¥à¸‡ |
| | `PUT /api/albums/:id/songs/order` | à¸ˆà¸±à¸”à¸¥à¸³à¸”à¸±à¸šà¹€à¸à¸¥à¸‡à¹ƒà¸™à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡ |
| | `DELETE /api/albums/:id/songs/:songId` | à¸¥à¸šà¹€à¸à¸¥à¸‡ (Soft Delete) |
| **Users** | `GET /api/users` | à¸”à¸¹à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ user à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (admin à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™) |
| | `PUT /api/users/:id` | à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ role à¸‚à¸­à¸‡ user (admin) |
| | `PUT /api/users/:id/ban` | à¹à¸šà¸™à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ (admin) |
| | `PUT /api/users/:id/unban` | à¸›à¸¥à¸”à¹à¸šà¸™à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ (admin) |
| **Statistics** | `GET /api/statistics?metrics=label` | à¸ªà¸–à¸´à¸•à¸´à¹€à¸à¸¥à¸‡à¸•à¸²à¸¡ Label |
| | `GET /api/statistics?metrics=album` | à¸ªà¸–à¸´à¸•à¸´à¹€à¸à¸¥à¸‡à¸•à¸²à¸¡ Album |
| | `GET /api/statistics?metrics=genre` | à¸ªà¸–à¸´à¸•à¸´à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡à¸•à¸²à¸¡ Genre |
| | `GET /api/statistics?metrics=popular` | 10 à¹€à¸à¸¥à¸‡à¸—à¸µà¹ˆà¸–à¸¹à¸à¸”à¸¹à¸¡à¸²à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸” |

### à¸‚à¹‰à¸­à¸à¸³à¸«à¸™à¸”à¸”à¹‰à¸²à¸™ Security

- à¸—à¸¸à¸ endpoint (à¸¢à¸à¹€à¸§à¹‰à¸™ login, register, GET albums, GET songs) à¸•à¹‰à¸­à¸‡à¸ªà¹ˆà¸‡ **Token** à¸¡à¸²à¹ƒà¸™ Header `X-Authorization`
- Password à¸•à¹‰à¸­à¸‡ hash à¸”à¹‰à¸§à¸¢ **bcrypt** à¸à¹ˆà¸­à¸™à¹€à¸à¹‡à¸šà¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ à¹€à¸ªà¸¡à¸­
- à¸£à¸°à¸šà¸š Role: `admin` â†’ `publisher` â†’ `user` â€” à¹à¸•à¹ˆà¸¥à¸° role à¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œà¸•à¹ˆà¸²à¸‡à¸à¸±à¸™

## à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µà¸à¹ˆà¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡

| à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­ | à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™ | à¹ƒà¸Šà¹‰à¸—à¸³à¸­à¸°à¹„à¸£ |
|:----------|:--------:|:---------|
| [Node.js](https://nodejs.org/) | v18+ | Runtime à¸ªà¸³à¸«à¸£à¸±à¸šà¸£à¸±à¸™ JavaScript à¸šà¸™ Server |
| [XAMPP](https://www.apachefriends.org/) | à¸¥à¹ˆà¸²à¸ªà¸¸à¸” | MySQL + phpMyAdmin |
| [Postman](https://www.postman.com/downloads/) | à¸¥à¹ˆà¸²à¸ªà¸¸à¸” | à¸—à¸”à¸ªà¸­à¸š API |
| [VS Code](https://code.visualstudio.com/) | à¸¥à¹ˆà¸²à¸ªà¸¸à¸” | Code Editor |

## Tech Stack à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰

| Package | à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ |
|:--------|:-------|
| `express` | HTTP Server Framework |
| `mysql2` | à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ MySQL (Promise-based) |
| `dotenv` | à¸­à¹ˆà¸²à¸™ Environment Variables à¸ˆà¸²à¸ `.env` |
| `cors` | à¸­à¸™à¸¸à¸à¸²à¸• Cross-Origin Request |
| `bcryptjs` | Hash à¹à¸¥à¸° Verify Password |
| `multer` | à¸£à¸±à¸š multipart/form-data (file upload) |
| `nodemon` | Auto-restart server à¹€à¸¡à¸·à¹ˆà¸­à¹à¸à¹‰à¹‚à¸„à¹‰à¸” (dev only) |

## à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸›à¸£à¹€à¸ˆà¹‡à¸„à¸—à¸µà¹ˆà¸ˆà¸°à¸ªà¸£à¹‰à¸²à¸‡

```
Demo Module C/
â”œâ”€â”€ .env                    # Environment Variables (DB, PORT)
â”œâ”€â”€ app.js                  # Entry point â€” à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Express + Middleware + Routes
â”œâ”€â”€ package.json
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.js         # MySQL Connection Pool
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.js             # à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Token + Role
â”‚   â””â”€â”€ upload.js           # à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Multer (file upload)
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth.js             # Login, Register, Logout
â”‚   â”œâ”€â”€ albums.js           # CRUD Albums
â”‚   â”œâ”€â”€ songs.js            # CRUD Songs
â”‚   â”œâ”€â”€ users.js            # User Management (Admin)
â”‚   â””â”€â”€ statistics.js       # Statistics
â”œâ”€â”€ uploads/                # à¹„à¸Ÿà¸¥à¹Œà¸£à¸¹à¸›à¸ à¸²à¸à¸—à¸µà¹ˆ upload à¸‚à¸¶à¹‰à¸™à¸¡à¸²
â””â”€â”€ module_c_db.sql         # SQL à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
```

## à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰

à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸Šà¸·à¹ˆà¸­ `04_module_c` à¸¡à¸µ 6 à¸•à¸²à¸£à¸²à¸‡:

```
users          â€” à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ (username, password_hash, role, token)
albums         â€” à¸­à¸±à¸¥à¸šà¸±à¹‰à¸¡à¹€à¸à¸¥à¸‡ (title, artist, genre, publisher_id)
songs          â€” à¹€à¸à¸¥à¸‡ (title, lyrics, track_order, deleted_at)
labels         â€” à¸›à¹‰à¸²à¸¢à¸à¸³à¸à¸±à¸šà¹€à¸à¸¥à¸‡ à¹€à¸Šà¹ˆà¸™ Pop, Rock, Jazz
song_labels    â€” à¹€à¸Šà¸·à¹ˆà¸­à¸¡ songs à¸à¸±à¸š labels (many-to-many)
user_view_logs â€” à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¹ˆà¸² user à¸„à¸™à¹„à¸«à¸™à¸”à¸¹à¹€à¸à¸¥à¸‡à¸­à¸°à¹„à¸£
```

## à¸ à¸²à¸à¸£à¸§à¸¡à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡ API

```
Client (Postman / Frontend)
         â”‚
         â”‚  HTTP Request + X-Authorization Header
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           Express App               â”‚
    â”‚                                     â”‚
    â”‚  Middleware: CORS, JSON Parser      â”‚
    â”‚         â”‚                           â”‚
    â”‚  Middleware: auth.js (à¸•à¸£à¸§à¸ˆ Token)  â”‚
    â”‚         â”‚                           â”‚
    â”‚  Route Handler (albums.js à¸¯à¸¥à¸¯)     â”‚
    â”‚         â”‚                           â”‚
    â”‚  MySQL Query (mysql2)               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚  JSON Response
         â–¼
      Client
```

::: tip ğŸ’¡ à¸§à¸´à¸˜à¸µà¹€à¸£à¸µà¸¢à¸™à¹ƒà¸«à¹‰à¹„à¸”à¹‰à¸œà¸¥
à¹à¸•à¹ˆà¸¥à¸° Step à¸ˆà¸°à¸­à¸˜à¸´à¸šà¸²à¸¢ **à¸—à¸¤à¸©à¸à¸µà¸à¹ˆà¸­à¸™** à¹à¸¥à¹‰à¸§ **à¸¥à¸‡à¹‚à¸„à¹‰à¸”à¸—à¸±à¸™à¸—à¸µ** à¸à¸£à¹‰à¸­à¸¡à¸—à¸”à¸ªà¸­à¸šà¸”à¹‰à¸§à¸¢ Postman à¸—à¸¸à¸ Step à¸­à¸¢à¹ˆà¸²à¸‚à¹‰à¸²à¸¡à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š â€” à¸à¸²à¸£à¹€à¸«à¹‡à¸™à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸ˆà¸£à¸´à¸‡à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¹„à¸”à¹‰à¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸²à¸­à¹ˆà¸²à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸”à¸µà¸¢à¸§à¸¡à¸²à¸
:::

# Database Schema

> ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `04_module_c` ‚Äî 6 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á

## ER Diagram (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á)

```
users
  ‚îÇ user_id (PK)
  ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ albums
  ‚îÇ  publisher_id (FK)   ‚îÇ album_id (PK)
  ‚îÇ                      ‚îÇ
  ‚îÇ                      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ songs
  ‚îÇ                         album_id (FK)      ‚îÇ song_id (PK)
  ‚îÇ                                            ‚îÇ
  ‚îÇ                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ song_labels ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ labels
  ‚îÇ                         ‚îÇ   song_id (FK)   ‚îÇ      label_id (FK)     label_id (PK)
  ‚îÇ                         ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     user_view_logs
       user_id (FK) ‚Üí users
       song_id (FK) ‚Üí songs
```

## ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `users`

‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

| Column | Type | Nullable | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|:-------|:-----|:--------:|:---------|
| `user_id` | INT AUTO_INCREMENT | ‚ùå | Primary Key |
| `username` | VARCHAR(50) UNIQUE | ‚ùå | ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô) |
| `password_hash` | VARCHAR(255) | ‚ùå | Password ‡∏ó‡∏µ‡πà hash ‡∏î‡πâ‡∏ß‡∏¢ bcrypt |
| `email` | VARCHAR(100) UNIQUE | ‚ùå | Email (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô) |
| `role` | ENUM('admin','publisher','user') | ‚ùå | ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (default: 'user') |
| `is_banned` | TINYINT(1) | ‚ùå | 0 = ‡∏õ‡∏Å‡∏ï‡∏¥, 1 = ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡∏ô (default: 0) |
| `token` | VARCHAR(255) | ‚úÖ | Token ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (NULL = ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login) |
| `created_at` | TIMESTAMP | ‚ùå | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á (auto) |
| `updated_at` | TIMESTAMP | ‚ùå | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (auto update) |

## ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `albums`

‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°‡πÄ‡∏û‡∏•‡∏á

| Column | Type | Nullable | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|:-------|:-----|:--------:|:---------|
| `album_id` | INT AUTO_INCREMENT | ‚ùå | Primary Key |
| `publisher_id` | INT | ‚ùå | FK ‚Üí users.user_id (‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°) |
| `title` | VARCHAR(150) | ‚ùå | ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏° |
| `artist` | VARCHAR(50) | ‚ùå | ‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô |
| `release_year` | YEAR(4) | ‚úÖ | ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ |
| `genre` | VARCHAR(100) | ‚úÖ | ‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á ‡πÄ‡∏ä‡πà‡∏ô Pop, Rock, Jazz |
| `description` | TEXT | ‚úÖ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏° |
| `created_at` | TIMESTAMP | ‚ùå | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á |
| `updated_at` | TIMESTAMP | ‚ùå | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î |

## ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `songs`

‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏•‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏û‡∏•‡∏á

| Column | Type | Nullable | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|:-------|:-----|:--------:|:---------|
| `song_id` | INT AUTO_INCREMENT | ‚ùå | Primary Key |
| `album_id` | INT | ‚úÖ | FK ‚Üí albums.album_id |
| `title` | VARCHAR(150) | ‚ùå | ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á |
| `duration_seconds` | INT | ‚úÖ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÄ‡∏û‡∏•‡∏á (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) |
| `cover_image_path` | VARCHAR(255) | ‚úÖ | ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏õ‡∏Å ‡πÉ‡∏ô `/uploads/` |
| `is_cover` | INT | ‚ùå | 0 = ‡πÄ‡∏û‡∏•‡∏á‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö, 1 = ‡πÄ‡∏û‡∏•‡∏á cover |
| `lyrics` | TEXT | ‚úÖ | ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á |
| `track_order` | INT | ‚úÖ | ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏° |
| `deleted_at` | TIMESTAMP | ‚úÖ | NULL = ‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà, ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ = ‡∏ñ‡∏π‡∏Å soft delete |
| `created_at` | TIMESTAMP | ‚ùå | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á |
| `updated_at` | TIMESTAMP | ‚ùå | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î |

::: tip üí° Soft Delete ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?
‡∏ó‡∏∏‡∏Å query ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á song ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç `WHERE deleted_at IS NULL` ‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
:::

## ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `labels`

‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏á

| Column | Type | Nullable | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|:-------|:-----|:--------:|:---------|
| `label_id` | INT AUTO_INCREMENT | ‚ùå | Primary Key |
| `name` | VARCHAR(255) | ‚ùå | ‡∏ä‡∏∑‡πà‡∏≠ label ‡πÄ‡∏ä‡πà‡∏ô Pop, Rock, Jazz |

**‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:**

| label_id | name |
|:--------:|:-----|
| 1 | Pop |
| 2 | Rock |
| 3 | Hip-Hop |
| 4 | Electronic |
| 5 | Jazz |
| 6 | Classical |
| 7 | Chill |
| 8 | Country |

## ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `song_labels`

‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° songs ‡∏Å‡∏±‡∏ö labels (Many-to-Many)

| Column | Type | Nullable | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|:-------|:-----|:--------:|:---------|
| `song_label_id` | INT AUTO_INCREMENT | ‚ùå | Primary Key |
| `song_id` | INT | ‚ùå | FK ‚Üí songs.song_id |
| `label_id` | INT | ‚ùå | FK ‚Üí labels.label_id |

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:** ‡πÄ‡∏û‡∏•‡∏á song_id=1 ‡∏°‡∏µ label Pop, Rock, Hip-Hop ‚Üí ‡∏°‡∏µ 3 ‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô song_labels

## ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `user_view_logs`

‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÄ‡∏û‡∏•‡∏á‡∏Ç‡∏≠‡∏á user

| Column | Type | Nullable | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|:-------|:-----|:--------:|:---------|
| `user_view_log_id` | INT AUTO_INCREMENT | ‚ùå | Primary Key |
| `user_id` | INT | ‚ùå | FK ‚Üí users.user_id |
| `song_id` | INT | ‚ùå | FK ‚Üí songs.song_id |

::: tip üí° ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?
‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Statistics `metrics=song` ‡πÅ‡∏•‡∏∞ `metrics=label` ‚Äî ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô logs ‡∏ï‡πà‡∏≠ song_id ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì `view_count` ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏û‡∏•‡∏á

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠ user ‡∏ó‡∏µ‡πà login ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `GET /api/songs/:id`
:::

## Foreign Key Constraints

```sql
albums.publisher_id     ‚Üí users.user_id
songs.album_id          ‚Üí albums.album_id
song_labels.song_id     ‚Üí songs.song_id
song_labels.label_id    ‚Üí labels.label_id
user_view_logs.user_id  ‚Üí users.user_id
user_view_logs.song_id  ‚Üí songs.song_id
```

::: warning ‚ö†Ô∏è ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ Foreign Key ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö related data ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏•‡∏ö album:
1. ‡∏•‡∏ö `song_labels` ‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á songs ‡πÉ‡∏ô‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°‡∏ô‡∏±‡πâ‡∏ô
2. ‡∏•‡∏ö `user_view_logs` ‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á songs ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
3. ‡∏•‡∏ö `songs` ‡πÉ‡∏ô‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°
4. ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏•‡∏ö `albums`
:::
